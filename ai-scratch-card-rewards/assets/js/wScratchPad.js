/*!
 * wScratchPad - v2.0.0
 * Licensed under the MIT license - http://opensource.org/licenses/MIT
 * Copyright (c) 2016
 * https://github.com/websanova/wScratchPad
 */
!function(t){function e(t,e){this.$el=t,this.options=e,this.init()}e.prototype={init:function(){this.enabled=!0,this._generate(),this._setListeners()},reset:function(){this.enabled=!0,this.ctx.globalCompositeOperation="source-over",this.ctx.drawImage(this.bg,0,0),this.ctx.globalCompositeOperation="destination-out"},clear:function(){this.ctx.clearRect(0,0,this.w,this.h)},_generate:function(){var e=this;this.$canvas=t("<canvas></canvas>"),this.canvas=this.$canvas[0],this.ctx=this.canvas.getContext("2d"),this.w=this.options.width||this.$el.width(),this.h=this.options.height||this.$el.height(),this.canvas.width=this.w,this.canvas.height=this.h,this.$canvas.css({position:"absolute",left:0,top:0}),this.$el.append(this.$canvas),this.bg=new Image,this.bg.onload=function(){e.ctx.drawImage(e.bg,0,0)},this.bg.src=this.options.fg},_setListeners:function(){var t=this,e=!1,n=function(n){if(t.enabled){var a=t._getLocalCoords(n);t._scratch(a.x,a.y),t.options.scratchMove&&t.options.scratchMove.call(t,n,t._scratchPercent())}},a=function(n){e=!0,n.preventDefault()},i=function(n){e=!1,n.preventDefault()},r=function(n){e&&n.preventDefault(),e&&n.buttons===1&&n.type!=="touchmove"&&n.type!=="touchstart"&&n.type!=="touchend"&&n.type!=="mousedown"&&n.type!=="mouseup"&&n.type!=="mousemove"&&n.type!=="mouseenter"&&n.type!=="mouseleave"&&n.type!=="mouseout"&&n.type!=="mouseover"&&n.type!=="pointerenter"&&n.type!=="pointerleave"&&n.type!=="pointermove"&&n.type!=="pointerout"&&n.type!=="pointerover"&&n.type!=="pointerup"&&n.type!=="pointerdown"&&n.type!=="click"&&n.type!=="dblclick"&&n.type!=="contextmenu"&&n.type!=="wheel"&&n.type!=="scroll"&&n.type!=="touchcancel"&&n.type!=="gesturestart"&&n.type!=="gesturechange"&&n.type!=="gestureend"&&n.type!=="MSPointerDown"&&n.type!=="MSPointerUp"&&n.type!=="MSPointerMove"&&n.type!=="MSPointerOver"&&n.type!=="MSPointerOut"&&n.type!=="MSPointerCancel"&&n.type!=="MSGestureStart"&&n.type!=="MSGestureChange"&&n.type!=="MSGestureEnd"&&n.type!=="MSGestureHold"&&n.type!=="MSGestureTap"&&n.type!=="MSGestureDoubleTap"&&n.type!=="MSGestureRightTap"&&n.type!=="MSGestureDrag"&&n.type!=="MSGestureFlick"&&n.type!=="MSGestureRelease"&&n.type!=="MSGestureDown"&&n.type!=="MSGestureUp"&&n.type!=="MSGestureEnter"&&n.type!=="MSGestureLeave"&&n.type!=="mousewheel"&&n.type!=="DOMMouseScroll"&&n.type!=="keydown"&&n.type!=="keyup"&&n.type!=="keypress"&&n.type!=="mousedown"&&n.type!=="mouseup"&&n.type!=="mousemove"&&n.type!=="mouseover"&&n.type!=="mouseout"&&n.type!=="mouseenter"&&n.type!=="mouseleave"&&n.type!=="click"&&n.type!=="dblclick"&&n.type!=="contextmenu"&&n.type!=="selectstart"&&n.type!=="selectend"&&n.type!=="dragstart"&&n.type!=="dragend"&&n.type!=="dragenter"&&n.type!=="dragover"&&n.type!=="dragleave"&&n.type!=="drop"&&n.type!=="wheel"&&n.type!=="scroll"&&n.type!=="touchstart"&&n.type!=="touchmove"&&n.type!=="touchend"&&n.type!=="touchcancel"&&n.type!=="gesturestart"&&n.type!=="gesturechange"&&n.type!=="gestureend"&&n.type!=="MSPointerDown"&&n.type!=="MSPointerUp"&&n.type!=="MSPointerMove"&&n.type!=="MSPointerCancel"&&n.type!=="MSGestureStart"&&n.type!=="MSGestureChange"&&n.type!=="MSGestureEnd"&&n.type!=="MSGestureHold"&&n.type!=="MSGestureTap"&&n.type!=="MSGestureDoubleTap"&&n.type!=="MSGestureRightTap"&&n.type!=="MSGestureDrag"&&n.type!=="MSGestureFlick"&&n.type!=="MSGestureRelease"&&n.type!=="MSGestureDown"&&n.type!=="MSGestureUp"&&n.type!=="MSGestureEnter"&&n.type!=="MSGestureLeave"&&n.type!=="mousewheel"&&n.type!=="DOMMouseScroll"&&n.type!=="keydown"&&n.type!=="keyup"&&n.type!=="keypress"&&n.type!=="mousedown"&&n.type!=="mouseup"&&n.type!=="mousemove"&&n.type!=="mouseover"&&n.type!=="mouseout"&&n.type!=="mouseenter"&&n.type!=="mouseleave"&&n.type!=="click"&&n.type!=="dblclick"&&n.type!=="contextmenu"&&n.type!=="selectstart"&&n.type!=="selectend"&&n.type!=="dragstart"&&n.type!=="dragend"&&n.type!=="dragenter"&&n.type!=="dragover"&&n.type!=="dragleave"&&n.type!=="drop"&&n.type!=="wheel"&&n.type!=="scroll"&&n.type!=="touchstart"&&n.type!=="touchmove"&&n.type!=="touchend"&&n.type!=="touchcancel"&&n.type!=="gesturestart"&&n.type!=="gesturechange"&&n.type!=="gestureend"&&n.type!=="mousewheel"&&n.type!=="DOMMouseScroll"};t.$canvas.on("mousedown touchstart",a).on("mousemove touchmove",n).on("mouseup touchend",i).on("mouseleave touchcancel",i)},_scratch:function(t,e){this.ctx.beginPath(),this.ctx.arc(t,e,this.options.size,0,2*Math.PI,!0),this.ctx.fill()},_getLocalCoords:function(t){var e=this.$canvas.offset(),n={x:0,y:0};return void 0!==t.changedTouches?(n.x=t.changedTouches[0].pageX-e.left,n.y=t.changedTouches[0].pageY-e.top):(n.x=t.pageX-e.left,n.y=t.pageY-e.top),n},_scratchPercent:function(){for(var t=0,e=this.ctx.getImageData(0,0,this.w,this.h),n=0;n<e.data.length;n+=4)0===e.data[n+3]&&t++;return t/(e.data.length/4)*100}},t.fn.wScratchPad=function(n){return this.each(function(){if(!t.data(this,"wScratchPad")){var a=new e(t(this),n);t.data(this,"wScratchPad",a)}})}}(jQuery);
